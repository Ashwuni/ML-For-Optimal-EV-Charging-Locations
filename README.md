# ML-For-Optimal-EV-Charging-Locations
AI algorithm that finds the optimal locations for placing EV charging stations. 

# Executive summary
This report investigates the dynamical location optimization problem for electric vehicles (henceforth referred to as EV) charging station infrastructure for long-distance trips to solve the obstacle of large-scale adoption of EVs. This report constructs and implements a construction heuristic algorithm and a corresponding simulated annealing metaheuristic in pursuit of feasible solutions, their neighbouring feasible solutions, and the overall minimization of the total cost of building EV charging stations for different origin-destination (OD) pairs.

# Problem Description
The lack of EV charging station infrastructure for long-distance trips has become an obstacle in the large-scale adoption of EVs in society and, thus, the future of EV’s is highly dependent on the construction of charging stations. As a result, we must develop and implement a construction heuristic to optimize the ability of EV drivers to travel between all available cities in any given OD pair via the shortest path between them.

# Description of the Algorithm
The main concern regarding the placement of EV charging stations is ensuring that all journeys within the specified network are completable. In other words, if we are looking at the Greater Toronto Area, regardless of whether a car begins the journey in Burlington or Mississauga and completes it in Brampton or Vaughn, the journey must be completable. A journey is only completable if, throughout the path the car travels, there is always an EV charging station within R of each other, where R is the range the EV driving is able to complete when it begins the journey fully charged. The value used for R was taken from the average range of a Tesla Model Y EV, 303 miles, [4] however, to account for the distance that needs to be driven from the geographical centre of the city to the location of the EV charging station and the vehicle battery that is required to enter a charging stall, the range used is 250 miles or approximately 400 km. As a result, given a network of cities in a specific OD pair, the algorithm must determine in which cities to locate EV charging stations so that every path within the OD pair is completable. 
To accomplish this, an algorithm was created. The algorithm iterates through all paths in an OD pair and iteratively builds EV charging stations throughout the path until all paths in the OD pair are completed. Paths are defined as every path m where m starts at city i and ends at city j and i and j are elements of the set of all cities in the OD pair data I and path m is the shortest route possible between the aforementioned i and j. The EV charging stations are built at the city t where the distance between city b and city t is the maximum distance of all cities following city b so long as the distance between the cities is within vehicle range R. City b is initialized as the path origin city i and then iterates through the newly determined EV charging station locations until the distance between all EV charging stations, and the distance between an EV charging stations and the path origin city i and path destination city j are within vehicle range R of each other. The pseudocode for the algorithm is available in Appendix B.
The algorithm provides data regarding all the cities in the OD pair, which cities are connected to each other, and the distances between connected cities. Once given this data, the algorithm iterates through all the possible paths in the OD pair. The path m that is added to a list - paths - is what is returned by the method dijsktra when the respective i and j inputs are passed to it. The dijsktra method works in union with the __init__ and add_edge methods. The pseudocode for these methods in addition to the eventually implemented code was sourced from benalexkeen.com. The exact source for this code can be seen in References: reference [1]. In essence, these methods are used to determine which path can be taken between the inputted origin i and destination j in order to minimize the overall distance travelled (the shortest path problem). 
Once all of these shortest path solutions are added to the path list, the algorithm calls the get_Can_list method to determine where to locate EV charging stations on each respective path. The method does this by iterating through the cities in the path in the order they come in and placing stations at the maximum feasible distance from each other. In other words, the algorithm considers an origin point wherein the car will begin its journey fully charged with a range R. The algorithm then iterates through all the cities in the path that come after this origin point, making note of the distance from the origin city to the city at hand. Once the algorithm identifies that the distance from the origin city to the city at hand has exceeded the specified vehicle range R, the algorithm adds the previously looked at city f to the candidates list (the last city whose distance from the origin city was less than the vehicle range R). The algorithm then resets the origin city as city f and repeats this iteration until the distance between all EV charging stations, and the distance between an EV charging station and the path origin city i and path destination city j are within vehicle range R of each other. This method returns the candidates list. 
Finally, to prevent double-counting and to make the solution as clear as possible, the algorithm takes the candidates list and adds all the unique stations mentioned to the unique_candidate list. The algorithm will then output the solution to this problem: the locations of where to build the EV charging stations. Furthermore, the algorithm will iterate through the cities in the unique_candidate list, summing up the costs for building a station in each city, and output the total cost for building the aforementioned stations. 
The assumptions made to implement this algorithm are located in Appendix F. 
In addition to the aforementioned algorithm - the construction heuristic - a metaheuristic was created to explore neighbouring feasible solutions to the initial feasible solution provided by our algorithm. Once a solution for an OD pair was provided by the algorithm, the created simulated annealing metaheuristic would investigate cities beside the EV charging station’s city (provided by the algorithm) and, if this neighbouring solution would lessen the cost of building this station, the metaheuristic would accept the neighbouring solution. If the neighbouring solution would lessen the cost of building this station, the metaheuristic would accept the neighbouring solution with some probability p. The pseudocode for the metaheuristic is in Appendix G.
The metaheuristic iterates through all paths in the solution provided by the algorithm and iteratively finds neighbouring feasible solutions for all EV charging stations throughout the path until all paths in the algorithm solution are looked at. In this situation, a neighbouring solution pertains to the relocating of an EV charging station from city n to the city that m that comes prior to n on the path m from path origin point i to path destination point j. In other words, if path m were to be [‘Toronto’, ‘Mississauga’, ‘Oakville’, ‘Burlington’, ‘Hamilton’] and our algorithm provided a solution for this path that an EV charging station were to be built at Burlington, the metaheuristic would consider the neighbouring solution Oakville. A neighbouring solution was said to be feasible if and only if the sum of the distance between the neighbouring solution m and the distance between the initial solution n and city g was less than the EV range R, where, if there is another EV charging station after the EV charging station under review, g is the distance between these two stations, otherwise g is the distance between the EV charging station under review and the path destination j. To continue with the previous example, the neighbouring solution Oakville is feasible if and only if the distance from Oakville to Hamilton is less than the EV range R. If there were another EV charging station in this path solution, say X, the solution would have been feasible if and only if the distance between Oakville and city X was less than R. This neighbouring feasible solution was then faced with two cases: if the cost of building an EV charging station at the neighbouring feasible solution was less than the cost of the EV charging station at the initial solution, the neighbouring feasible solution was accepted. However, if this was not the case, the neighbour feasible solution was accepted with some probability p where (as per the lectures): 
p(accept candidate solution) = e(Zc - Zn)/T
where Zc is the cost of the EV charging station at the initial solution, Zn is the cost of building an EV charging station at the neighbouring feasible solution, and T is the temperature - a parameter measuring the tendency to accept the neighbouring feasible solution - which was set to 0.4. Once calculated, if the probability p were greater than 0.95, the neighbouring feasible solution was accepted. If not, then the EV charging station remained at the initial solution.

# Numerical testing

In order to test the algorithm, data were obtained on three different OD pairs: Toronto, Ontario to Montréal, Québec; Allentown, Pennsylvania to New Haven, Connecticut; and Yreka, California to San Francisco, California. Please refer to Appendix C for this data. The purpose for choosing these pairs are as follows:
The Toronto to Montréal OD pair has data that is very clustered on one end and then trails off in a very narrow path on the other end. This data was used to test the algorithm against varied path lengths. 
The Allentown to New Haven OD pair has data that falls all over the informal Ivy loop. The loop covers the general area around and between Ivy League schools in the United States (refer to Appendix E). As a very popular road trip for students, education staff, and parents and guardians alike, this interstate trip is a prime candidate for encouraging and affording federal government-funded stations. For instance, this data could apply in a situation such as the one outlined in Grist’s article: Biden wants to build 500,000 EV charging stations. Where will they all go? [3].
The Yreka to San Francisco OD pair has data that solely falls within the northern half of the California state. Data like this might be used by the state of California to build federal or state government-funded stations. Alternatively, as the location where Tesla was founded - a leader in EV technology -  this location is a prime candidate for the building of privately funded EV charging stations. 
A visual representation of the network described by the data for the Yreka, California to San Francisco, California OD pair can be found in Appendix H. The network was determined by paralleling the selected cities in the north California region with the major highway systems for this region. 
The output and solutions for the algorithm and the metaheuristic discussed in ‘Description of the Algorithm’ are located in Appendix A.
Let us consider the computational time of the algorithm. As shown in the output, the runtime for the Toronto, Ontario to Montréal, Québec OD pair, the Allentown, Pennsylvania to New Haven, Connecticut OD pair, and the Yreka, California to San Francisco, California OD pair are 0.0433946509983798 seconds,  0.03033331899860059 seconds, and 0.12931593399844132 seconds, respectively. We can see that these runtimes at first glance are quite good however, as a more formal indicator, we can compare how the algorithm fared for the datasets of the greatest difference in magnitudes: the Toronto, Ontario to Montréal, Québec OD pair and the Yreka, California to San Francisco, California OD pair. Let us refer to them as CAN and USA, respectively. As the difference between the average distance between cities for USA and CAN is relatively quite insignificant - 25.3953488 km  - we can comfortably compare the impact the number of cities has on the performance of the algorithm. With almost twice the number of cities, the USA's runtime was approximately 2.979997097 that of CAN. As the number of cities added to the dataset shares a quadratic relationship to the number of paths m - m=n*(n-1), we can understand that the runtime doesn’t share a linear relationship with the number of cities in the dataset either. In fact, the aforementioned quadratic relationship indicates that, for the expected quadratic increase in the number of paths to implement EV charging stations on, the algorithm fared quite well: only increasing 2.979997097 fold. As a construction heuristic, the algorithm aims to “decrease the time complexity of problems by giving quick solutions” [6]. Therefore, at its core, the runtime of the algorithm is a good indicator of the quality of our heuristic and its usability. Furthermore, as the potential for our problem is quite limitless, the quality and usability of the heuristic is that much more important. For instance, the data used to test this algorithm is essentially insignificant in comparison to the vast and extensive amounts of data that apply to the topic of locating EV charging stations. For instance, this algorithm could be used on all the potential locations for EV charging stations in the entirety of the United States of America down to the exact street address!
Next, let us compare the performance of the algorithm and the metaheuristic. We see two different situations demonstrated by our three different OD pairs: the metaheuristic reveals that the problem is still feasible and cheaper with less charging stations or the metaheuristic solution is identical to the algorithm solution. In the Toronto, Ontario to Montréal, Québec OD pair, the algorithm returns EV stations located at Toronto, Ajax, and Pickering whereas the metaheuristic simply returns Toronto and Pickering. As Toronto and Ajax are beside one another, this indicates that the metaheuristic identified that path(s) that locate EV charging stations in Ajax are completable and have cheaper costs if we move the station back to Toronto. Toronto was already on the solution list but the metaheuristic identified no need for the addition of Ajax. This is a very good result from the metaheuristic as having to build one less station greatly reduces the total cost for the OD pair, a very good situation in light of our wanting to minimize the objective value. Similarly, the metaheuristic solution for the Yreka, California to San Francisco, California OD pair eliminates the need for two stations - Redwood City and Markleeville - which shows the potential for the cost reduction possibilities of the metaheuristic. On the other hand, the Allentown, Pennsylvania to New Haven, Connecticut OD pair implies that, either the algorithm returned the only possible feasible solutions for each path, neighbouring solutions were not cheaper options, or that even the relocation of certain path EV charging station solutions could not eliminate the need for any cities. This gives insight into the strength of our algorithm and its ability to return good quality results. 
Finally, let us consider the quality of our algorithm and metaheuristic. I believe the solutions provided by both our algorithm and our metaheuristic are of high quality. Our heuristic ensures that all paths are completable and does so in the minimum stations required per path. In general, we see that the estimated costs of building EV charging stations are larger than the estimated differences in building different stations. For instance, for our Yreka, California to San Francisco, California OD pair, the estimated cost of building an EV charging station is $126751.04 and the estimated difference in cost of building different stations is $91369.99. Therefore minimizing the number of EV charging stations on a path such that the path is always completable is very significant in the minimization of our objective value: the cost of building said EV charging stations. Furthermore, at its core, the algorithm considers every path within the inputted OD pair. This is very realistic as transportation between cities is a very dynamic network and we have no control over where drivers begin their journeys and where they end them. Furthermore, the algorithm uses the shortest path for each path. Once again, we have no control over drivers and can’t force them to take the more convenient route between their origin and destination for us. Therefore, as taking the shortest path between their origin point and destination is a more realistic expectation, our algorithm once again encourages realism. The use of every shortest path results in the algorithm being set up in a high-quality, realistic way. 
Our metaheuristic, on the other hand, investigates neighbouring solutions and obtains better solutions for our data (better objective values). Our metaheuristic is of high quality as it does not impact the completability of any paths and does not implement any additional costly EV charging stations, yet it is able to find neighbouring solutions which can improve our overall objective value. In other words, the metaheuristic maintains the same level of feasibility as our algorithm and does not sacrifice the effectiveness of our algorithm in terms of minimizing the overall cost while locating better solutions for the case at hand. Not to mention, the metaheuristic upholds the realism and quality of the algorithm. Another good quality of the metaheuristic is how useful it is in realistic situations. Realistically, even locations of relatively minimal distance apart can have drastic price differences. For instance, in Toronto, ON the cost of building an EV charging station - as per our previously discussed estimation calculation - in the Wellesley station region is $130,517.58, whereas the cost in the Union station region is $618,879.55. At a mere 3 km apart, in the face of the 400km range value of an EV and average intercity distance of 64.56521739 km (obtained from the Toronto, Ontario to Montréal, Québec OD pair data), this distance is very insignificant yet holds great potential for lowering overall EV charging station costs.
